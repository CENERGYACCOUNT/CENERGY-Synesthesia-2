AddCSLuaFile();--[[/* Copyright (C) Particularly Me - All Rights Reserved * Unauthorized copying of this file, via any medium is strictly prohibited, including distribution * Proprietary and confidential * Written by Rune Knight, rune4533@hotmail.com, August 2016 */ --]] ENT.Base = "base_anim";ENT.Type = "anim";ENT.PrintName		= "Citizen Ration Disp.";ENT.Author			= "Rune Knight";ENT.Contact			= "";ENT.Purpose			= "To get citizens to drop begging.";ENT.Instructions	= "";ENT.Spawnable				= true;ENT.AdminSpawnable			= true;ENT.AutomaticFrameAdvance	= true;function ENT:PostEntityPaste( ply, ent, tab )		GAMEMODE:LogSecurity( ply:SteamID(), "n/a", ply:VisibleRPName(), "Tried to duplicate " .. ent:GetClass() .. "!" );	ent:Remove();	endfunction ENT:Initialize()		self:SetModel( "models/props_combine/combine_dispenser.mdl" );		if( SERVER ) then				self:PhysicsInit( SOLID_BBOX );		self:SetMoveType( MOVETYPE_VPHYSICS );		self:SetSolid( SOLID_BBOX );				local phys = self:GetPhysicsObject();				if( phys and phys:IsValid() ) then						phys:EnableMotion( false );					end				self:SetUseType( SIMPLE_USE );			end	endfunction ENT:Use( ply )		if( SERVER ) then				local flag = GAMEMODE:LookupCombineFlag( ply:CombineFlag() );				if( !flag ) then				if( ply:CPRationDate() == "" or util.TimeSinceDate( ply:CPRationDate() ) > 0.01 ) then					if( !ply:CanTakeItem( "ration" ) ) then										net.Start( "nCitizenRationTooHeavy" );					net.Send( ply );					return;							end					self:ResetSequence( self:LookupSequence( "dispense_package" ) );							self:EmitSound( Sound( "Buttons.snd6" ) );							net.Start( "nCitizenRation" );			net.Send( ply );				ply:SetCPRationDate( os.date( "!%m/%d/%y %H:%M:%S" ) );			ply:UpdateCharacterField( "CPRationDate", ply:CPRationDate() );					else								self:EmitSound( Sound( "Buttons.snd10" ) );								net.Start( "nCitizenRationTooEarly" );				net.Send( ply );							end					else						self:EmitSound( Sound( "Buttons.snd10" ) );						net.Start( "nCitizenRationNotCitizen" );			net.Send( ply );					end			end	endfunction ENT:Think()		self:NextThink( CurTime() );	return true;	end--[[	Instructions on how to set this thing up:	1) sv_net.lua	util.AddNetworkString( "nCitizenRation" );	util.AddNetworkString( "nCitizenRationNotCitizen" );	util.AddNetworkString( "nCitizenRationTooEarly" );	util.AddNetworkString( "nCitizenRationTooHeavy" );	Shove that somewhere you think it'll fit.--]]if( CLIENT ) then		function nCitizenRation( len )				GAMEMODE:AddChat( Color( 200, 200, 200, 255 ), "CombineControl.ChatNormal", "You take your ration.", { CB_ALL, CB_IC } );			end	net.Receive( "nCitizenRation", nCitizenRation );		function nCitizenRationNotCitizen( len )				GAMEMODE:AddChat( Color( 200, 0, 0, 255 ), "CombineControl.ChatNormal", "You're a Civil Protection officer, get a ration from the nexus instead.", { CB_ALL, CB_IC } );			end	net.Receive( "nCitizenRationNotCitizen", nCitizenRationNotCitizen );		function nCitizenRationTooHeavy( len )				GAMEMODE:AddChat( Color( 200, 0, 0, 255 ), "CombineControl.ChatNormal", "Your inventory is too full to carry the ration.", { CB_ALL, CB_IC } );			end	net.Receive( "nCitizenRationTooHeavy", nCitizenRationTooHeavy );		function nCitizenRationTooEarly( len )				GAMEMODE:AddChat( Color( 200, 0, 0, 255 ), "CombineControl.ChatNormal", "The distribution machine only distributes one ration every six hours.", { CB_ALL, CB_IC } );			end	net.Receive( "nCitizenRationTooEarly", nCitizenRationTooEarly );	endfunction ENT:CanPhysgun()		return false;	end